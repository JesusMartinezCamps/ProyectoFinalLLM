(function(){"use strict";TS.registerModule("web.emoji",{onStart:function(){TS.web.login_sig.add(TS.web.emoji.onLogin,TS.web.emoji);TS.web.emoji.bindUI()},onLogin:function(){$("#emoji_alias_preview").html(TS.emoji.graphicReplace(":"+$("#emojialias").val()+":"));$("#emoji_inline_preview").html(TS.emoji.graphicReplace(":"+$("#emoji_inline_preview").data("name")+":"));_ingestFrequents()},bindUI:function(){$("#addemoji input[name=mode]").change(function(){var selected=$("#addemoji input[name=mode]:checked").val();$(".radio_selection").removeClass("active");$(this).closest(".radio_selection").addClass("active");if(selected==="alias"){$("#emojialias").prop("disabled",false)}else{$("#emojialias").prop("disabled",true)}if(selected==="data"){$("#emojiimg").prop("disabled",false)}else{$("#emojiimg").prop("disabled",true)}});$('[data-action="choose_emoji_alias"]').on("click",function(e){e.preventDefault();_openEmojiMenu(e)});$("#custom_emoji").on("click",'[data-action="emoji.remove"]',function(){var emoji_type=$(this).data("emoji-type")==="alias"?TS.i18n.t("alias","emoji")():TS.i18n.t("emoji","emoji")();var emoji_name=$(this).data("emoji-name");var emoji_img=TS.emoji.graphicReplace(":"+emoji_name+":");var $row=$(this).closest(".emoji_row");$row.addClass("highlight_red_bg");var msg=TS.i18n.t("<p>Are you sure you want to remove this {emoji_type} (:{emoji_name}: {emoji_img})?</p><p>Its aliases will also be deleted.</p><p>This cannot be undone.</p>","emoji")({emoji_type:emoji_type,emoji_name:_.escape(emoji_name),emoji_img:emoji_img});if(!_has_seen_delete_confirmation){TS.generic_dialog.start({title:TS.i18n.t("Remove this emoji?","emoji")(),body:msg,show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Remove","emoji")(),go_button_class:"btn_danger",onGo:function(){deleteEmoji()}});_has_seen_delete_confirmation=true}else{deleteEmoji()}function deleteEmoji(){$row.fadeOut(500);return new Promise(function(resolve,reject){TS.api.callImmediately("emoji.remove",{name:emoji_name}).then(function(){resolve()},function(error){TS.generic_dialog.alert(TS.i18n.t("Hmmm ... that didnâ€™t work for some reason. Please wait a moment and try again.","emoji")());TS.info("Problem in emoji.remove request."+error);$row.removeClass("highlight_red_bg").fadeIn(150);reject(error)})})}});$("#custom_emoji").on("click",".rename_emoji",function(){var emoji_name=$(this).data("emoji-name");var emoji_img=TS.emoji.graphicReplace(":"+emoji_name+":");var $form=$(this).closest("form");var $new_name=$form.find("[name=new_name]");var msg=TS.i18n.t('<p class="align_center"><label>Enter a new name for {emoji_img} <span class="normal">(was :{emoji_name}:)</span></label><input type="text" class="input_inline no_bottom_margin" id="emoji_rename_input" value="{new_emoji_name}" placeholder="name"></p>',"emoji")({emoji_name:_.escape(emoji_name),emoji_img:emoji_img,new_emoji_name:_.escape($new_name.val())});TS.generic_dialog.start({title:TS.i18n.t("Rename your emoji","emoji")(),body:msg,show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Rename","emoji")(),enter_always_gos:true,onGo:function(){var new_name=$("#emoji_rename_input").val().replace(/:/g,"");if(!new_name){return false}if(new_name.match(/[^a-z0-9-_]/)){alert(TS.i18n.t("{new_name} contains illegal characters. Custom emoji names can only contain lower case letters, numbers, dashes and underscores.","emoji")({new_name:new_name}));return false}if(":"+new_name+":"!=TS.emoji.replaceColons(":"+new_name+":")){alert(TS.i18n.t("{new_name} is already in use!","emoji")({new_name:new_name}));return false}$new_name.val(new_name);$form.submit()}})});$("#custom_emoji .lazy").one("lazyloaded",function(){$(this).css("background-color","transparent")}).lazyload()}});var _has_seen_delete_confirmation=false;var _ingestFrequents=function(){TS.prefs.mergeEmojiUse(TS.model.prefs.emoji_use);TS.emoji.maybeRemakeMenuListsIfFrequentsChanged()};var _openEmojiMenu=function(e){TS.ui.react_emoji_menu.start({e:e,callback:_onEmojiSelected})};var _onEmojiSelected=function(emoji_name){if(emoji_name){$("#set_emoji_alias").addClass("hidden");$("#emoji_alias_container").removeClass("hidden");$("#addemoji input[name=mode][value=alias]").prop("checked",true);if(TS.boot_data.feature_localization){emoji_name=TS.emoji.maybeGetCanonicalEmojiString(emoji_name)}$('input[name="alias"]').val(_normalizeEmojiName(emoji_name));$("#emoji_alias_preview").html(TS.emoji.graphicReplace(emoji_name))}};var _normalizeEmojiName=function(emoji_name){emoji_name=emoji_name.replace(/(:skin-tone-[2-6]:)/,"");emoji_name=emoji_name.replace(/:/g,"");return emoji_name}})();
